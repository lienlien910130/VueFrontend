<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="智慧消防">
    <link rel="apple-touch-icon" sizes="76x76" href="./static/manifestimg/76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="./static/manifestimg/152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="./static/manifestimg/180.png" />
    <title><%= webpackConfig.name %></title>
    <script src="https://cdn.jsdelivr.net/npm/mobile-detect@1.4.5/mobile-detect.min.js"></script>
    <link rel="manifest"  href="/static/manifest.json" /> 
  </head>
  <body>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
</html>
<script  type="module">


// if ('serviceWorker' in navigator) {
//   window.addEventListener('load', function () {
//     navigator.serviceWorker.register('/firebase-messaging-sw.js',{scope: '/'})
//       .then((registration) => {
//         console.log('firebase-messaging-sw.js')
//     }).catch(err => {
//         console.log(err)
//     })
//   })
// }

// if ('serviceWorker' in navigator) {
//   window.addEventListener('load', function () {
//     navigator.serviceWorker.register('/service-worker.js', {scope: '/'})
//       .then(function (registration) {
//         console.log('註冊成功')
//         const publicKey = 'BIeLIMiIXA-V3MPD9zid-9kL1959CLyTx7YgxyMcsvSjBOCNl9O6FTQiuF-uaKK1S4FGfVtg42NxsZ9GFIJj7k0'// 和后台保持一致
//         registration.pushManager.getSubscription().then(subscription => {
//           if (!subscription ) {
//             const subscription = registration.pushManager.subscribe({
//               userVisibleOnly: true, // 表明该推送是否需要显性地展示给用户，即推送时是否会有消息提醒。如果没有消息提醒就表明是进行“静默”推送。在Chrome中，必须要将其设置为true，否则浏览器就会在控制台报错
//               applicationServerKey: urlBase64ToUint8Array(publicKey)// web-push定义的客户端的公钥，用来和后端的web-push对应，需要进行一次转换
//             })

//             // 用户同意
//               .then(function (subscription) {
//                 console.log('用戶同意訂閱:'+JSON.stringify(subscription))
//                 if (subscription && subscription.endpoint) {
//                   // 存入数据库
//                 }
//               })

//             // 用户不同意或者生成失败
//               .catch(function (err) {
//                 console.log('用戶不同意訂閱：'+err)
//               })
//           } else { // 用户已经订阅过
//             console.log('已訂閱過')
//           }
//         })
//       })
//       .catch(function (err) {
//         console.log('註冊失敗:'+err)
//       })
//   })
// }

// this.$messaging.onMessage((payload) => {
//   console.log('Message receiver ', payload)
//   let notification = payload.notification
//   console.log('Notification: ', notification)
// })

// window.onload = function() {
//   getVersion()
//   getBrand()
//   getNetwork()
//   console.log('版本=>'+this.os_version+',手機型號=>'+model+',操作系統=>'+this.os_type+',網路類型=>'+this.device_network_type)
// }

// const os_version ='' //版本
// const model = '' //手機型號
// const os_type = '' //操作系統
// const device_network_type = '' //網路類型

// function urlBase64ToUint8Array (base64String) {
//   const padding = '='.repeat((4 - base64String.length % 4) % 4)
//   const base64 = (base64String + padding)
//     .replace(/\-/g, '+')
//     .replace(/_/g, '/')

//   const rawData = window.atob(base64)
//   const outputArray = new Uint8Array(rawData.length)

//   for (let i = 0; i < rawData.length; ++i) {
//     outputArray[i] = rawData.charCodeAt(i)
//   }
//   return outputArray
// }

// function getVersion() {
//   var u = navigator.userAgent,version = ''
//   if (u.indexOf('Mac OS X') > -1) {
//       //ios
//       var regStr_saf = /OS [\d._]*/gi
//       var verinfo = u.match(regStr_saf)
//       version = (verinfo + "").replace(/[^0-9|_.]/ig,'').replace(/_/ig,'.')
//   } else if (u.indexOf('Android') > -1
//       || u.indexOf('Linux') > -1) {
//       //android
//       version = u.substr(u.indexOf('Android') + 8, u.indexOf(";", u.indexOf("Android")) - u.indexOf('Android') - 8)
//   } else if (u.indexOf('BB10') > -1) {
//       //黑莓bb10系统
//       version = u.substr(u.indexOf('BB10') + 5, u.indexOf(";", u.indexOf("BB10")) - u.indexOf('BB10') - 5)
//   } else if (u.indexOf('IEMobile')) {
//       //windows phone
//       version = u.substr(u.indexOf('IEMobile') + 9, u.indexOf(";", u.indexOf("IEMobile")) - u.indexOf('IEMobile') - 9)
//   }
//   this.os_version = version
// }

// function getBrand(){
//     var md = new MobileDetect(navigator.userAgent)
//     var device_type = navigator.userAgent//获取userAgent信息
//     this.os_type = md.os()
//     var model = ""
//     if (this.os_type == "iOS") {//ios系统的处理
//       model = md.mobile()
//     } else if (this.os_type == "AndroidOS") {//Android系统的处理
//       var sss = device_type.split(";")
//       var i = sss.contains("Build/")
//       if (i > -1) {
//         model = sss[i].substring(0, sss[i].indexOf("Build/"))
//       }
//     }
//     this.model = model
// }

// function getNetwork(){
//     var device_type = navigator.userAgent
//     var networkStr = device_type.match(/NetType\/\w+/) ? device_type.match(/NetType\/\w+/)[0] : 'NetType/other'
//     networkStr = networkStr.toLowerCase().replace('nettype/', '')
//     var networkType
//     switch (networkStr) {
//         case 'wifi':
//             networkType = 'wifi'
//             break;
//         case '4g':
//             networkType = '4g'
//             break;
//         case '3g':
//             networkType = '3g'
//             break;
//         case '3gnet':
//             networkType = '3g'
//             break;
//         case '2g':
//             networkType = '2g'
//             break;
//         default:
//             networkType = 'other'
//     }
//     this.device_network_type = networkType
// }

</script>
